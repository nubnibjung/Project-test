<div class="min-h-screen bg-[#e5e7f3] flex items-center justify-center">
  <div
    class="w-full bg-white rounded-[32px] shadow-[0_24px_80px_rgba(15,23,42,0.18)] overflow-hidden flex"
  >
    <!-- SIDEBAR -->
    <aside
      class="w-64 bg-gradient-to-b from-[#f3e3ff] via-[#f7f0ff] to-[#ffeef2] border-r border-white/60 flex flex-col"
    >
      <div class="px-6 pt-6 pb-4 flex items-center gap-2">
        <div
          class="w-9 h-9 rounded-2xl bg-indigo-500 text-white grid place-items-center font-semibold"
        >
          w
        </div>
        <div class="font-semibold text-slate-900 text-sm">weihu</div>
      </div>

      <nav class="px-3 mt-3 space-y-6 text-xs text-slate-500">
        <div>
          <p class="uppercase tracking-[0.2em] text-[10px] text-slate-400 mb-2">
            TASKS
          </p>
          <button
            class="w-full flex items-center gap-3 px-3 py-2 rounded-2xl bg-white text-indigo-600 font-medium shadow-sm"
          >
            <span class="text-lg">
              <i class="bi bi-check2"></i> </span
            ><span class="text-xs">Tasks</span>
            <span
              class="ml-auto text-[10px] bg-indigo-500 text-white rounded-full px-2 py-0.5"
              >{{ totalTasks() }}</span
            >
          </button>
          <button
            class="mt-1 w-full flex items-center gap-3 px-3 py-2 rounded-2xl hover:bg-white/60"
          >
            <span class="text-lg">
              <i class="bi bi-lightning-fill"></i> </span
            ><span class="text-xs">Activities</span>
          </button>
        </div>

        <div>
          <p class="uppercase tracking-[0.2em] text-[10px] text-slate-400 mb-1">
            MAIN
          </p>
          <button
            class="w-full flex items-center gap-3 px-3 py-2 rounded-2xl hover:bg-white/60"
          >
            <span>
              <i class="bi bi-speedometer2"></i> </span
            ><span>Dashboard</span>
          </button>
          <button
            class="w-full flex items-center gap-3 px-3 py-2 rounded-2xl hover:bg-white/60"
          >
            <span>
              <i class="bi bi-calendar3"></i> </span
            ><span>Schedule</span>
          </button>
          <button
            class="w-full flex items-center gap-3 px-3 py-2 rounded-2xl hover:bg-white/60"
          >
            <span>
              <i class="bi bi-journal-text"></i> </span
            ><span>Note</span>
          </button>
          <button
            class="w-full flex items-center gap-3 px-3 py-2 rounded-2xl hover:bg-white/60"
          >
            <span>
              <i class="bi bi-bag-fill"></i> </span
            ><span>Products</span>
          </button>
          <button
            class="w-full flex items-center gap-3 px-3 py-2 rounded-2xl hover:bg-white/60"
          >
            <span>
              <i class="bi bi-bar-chart-fill"></i> </span
            ><span>Report</span>
          </button>
        </div>

        <div>
          <p class="uppercase tracking-[0.2em] text-[10px] text-slate-400 mb-1">
            RECORDS
          </p>
          <button
            class="w-full flex items-center gap-3 px-3 py-2 rounded-2xl hover:bg-white/60"
          >
            <span>
              <i class="bi bi-people-fill"></i> </span
            ><span>Team</span>
          </button>
          <button
            class="w-full flex items-center gap-3 px-3 py-2 rounded-2xl hover:bg-white/60"
          >
            <span>
              <i class="bi bi-briefcase-fill"></i> </span
            ><span>Clients</span>
          </button>
        </div>

        <div>
          <p class="uppercase tracking-[0.2em] text-[10px] text-slate-400 mb-1">
            SUPPORT
          </p>
          <button
            class="w-full flex items-center gap-3 px-3 py-2 rounded-2xl hover:bg-white/60"
          >
            <span>
              <i class="bi bi-gear-fill"></i> </span
            ><span>Settings</span>
          </button>
          <button
            class="w-full flex items-center gap-3 px-3 py-2 rounded-2xl hover:bg-white/60"
          >
            <span>
              <i class="bi bi-life-preserver"></i> </span
            ><span>Support</span>
          </button>
        </div>
      </nav>

      <div class="mt-auto p-4 border-t border-white/60">
        <div class="flex items-center gap-3">
          <div
            class="w-9 h-9 rounded-full bg-slate-900 text-white grid place-items-center text-xs font-semibold"
          >
            BS
          </div>
          <div>
            <p class="text-xs font-semibold text-slate-900 leading-tight">
              Brooklyn Simmons
            </p>
            <p class="text-[10px] text-slate-400">brooklyncom</p>
          </div>
        </div>
      </div>
    </aside>

    <!-- MAIN -->
    <main
      class="flex-1 flex flex-col bg-gradient-to-br from-white via-[#f8fbff] to-[#fef6ff]"
    >
      <!-- TOP BAR -->
      <header
        class="h-16 border-b border-slate-100/70 flex items-center px-6 gap-4"
      >
        <div class="flex flex-col">
          <span class="text-[11px] text-slate-400">Welcome,</span>
          <span class="text-sm font-semibold text-slate-900"
            >Brooklyn Simmons</span
          >
        </div>

        <div class="flex-1 flex justify-center">
          <div class="w-full max-w-xl relative">
            <input
              type="text"
              placeholder="Find something"
              class="w-full rounded-2xl bg-slate-50 border border-slate-200 text-xs px-9 py-2 outline-none focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300"
            />
            <span
              class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm"
            >
              <i class="bi bi-search"></i>
            </span>
            <span
              class="absolute right-3 top-1/2 -translate-y-1/2 text-[10px] px-2 py-0.5 rounded-xl bg-white border border-slate-200 text-slate-400"
            >
              <i class="bi bi-command"></i> K
            </span>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <button
            class="w-8 h-8 rounded-full bg-white border border-slate-200 grid place-items-center text-sm"
          >
            <i class="bi bi-bell-fill"></i>
          </button>
          <button
            class="w-8 h-8 rounded-full bg-white border border-slate-200 grid place-items-center text-sm"
          >
            <i class="bi bi-gear-fill"></i>
          </button>
        </div>
      </header>

      <!-- BOARD HEADER -->
      <div class="px-6 pt-4 pb-2 flex items-center justify-between">
        <div>
          <p class="text-[11px] text-slate-400">May · Board</p>
          <h1 class="text-base font-semibold text-slate-900">Daily Tasks</h1>
          <p class="text-[10px] text-slate-400">
            Today is Saturday, Jul 8th, 2023
          </p>
        </div>

        <div class="flex items-center gap-3">
          <button
            class="hidden md:inline-flex items-center gap-2 text-[11px] px-3 py-1.5 rounded-2xl bg-white border border-slate-200"
          >
            <span>Filters</span><span>▾</span>
          </button>
          <button
            class="inline-flex items-center gap-2 text-[11px] px-4 py-2 rounded-2xl bg-slate-900 text-white shadow-md"
          >
            <span>＋</span><span>Create task</span>
          </button>
        </div>
      </div>

      <!-- BOARD COLUMNS -->
      <section class="flex-1 overflow-x-auto px-5 pb-6 pt-2">
        <div class="flex gap-4 min-w-max">
          <div
            *ngFor="let col of columns()"
            class="w-72 bg-white/70 border border-slate-100 rounded-[24px] p-4 shadow-[0_10px_30px_rgba(15,23,42,0.06)] flex flex-col"
          >
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-slate-300"></span>
                <h2 class="text-xs font-semibold text-slate-900">
                  {{ col.title }}
                </h2>
              </div>
              <button
                class="w-6 h-6 rounded-full bg-slate-50 grid place-items-center text-slate-400 text-xs"
                (click)="onAddTask(col.id)"
              >
                ＋
              </button>
            </div>

            <div
              class="space-y-3 overflow-y-auto pr-1"
              style="max-height: calc(100vh - 230px)"
            >
              <article
                *ngFor="let card of getTasks(col.id)"
                class="rounded-2xl bg-gradient-to-br p-3 text-[11px] shadow-[0_10px_30px_rgba(15,23,42,0.10)] cursor-pointer hover:-translate-y-0.5 hover:shadow-[0_16px_40px_rgba(15,23,42,0.18)] transition"
                [ngClass]="card.bg"
                (click)="openEditModal(card)">

                <!-- tags + delete -->
                <div class="flex items-start justify-between mb-2">
                  <div class="flex flex-wrap gap-1">
                    <span
                      *ngFor="let tag of card.tags"
                      class="inline-flex items-center px-2 py-[2px] rounded-full bg-white/70 text-[10px] font-medium text-slate-600"
                    >
                      {{ tag }}
                    </span>
                  </div>
                  <button
                    class="text-slate-400 hover:text-red-500 text-xs ml-1"
                    (click)="onDeleteTask(card, $event)"
                  >
                    ✕
                  </button>
                </div>

                <!-- title + desc -->
                <h3 class="font-semibold text-slate-900 text-[12px] mb-1">
                  {{ card.title }}
                </h3>
                <p class="text-[10px] text-slate-600 whitespace-pre-line mb-2">
                  {{ card.description }}
                </p>

                <!-- progress section -->
                <div class="flex items-center justify-between mb-1">
                  <div class="flex items-center gap-1">
                    <span class="text-[10px] text-slate-600">Progress</span>
                    <button
                      class="text-[9px] text-slate-500 underline"
                      (click)="onAdjustTaskMeta(card, $event)"
                    >
                      Edit
                    </button>
                  </div>
                  <span class="text-[10px] font-medium text-slate-700">
                    {{ card.progressPercent || 0 }}%
                  </span>
                </div>

                <!-- footer avatars + counters -->
                <div class="flex items-center justify-between mt-1">
                  <div class="flex -space-x-1">
                    <div
                      *ngFor="let p of card.people"
                      class="w-6 h-6 rounded-full bg-white/90 border border-white text-[9px] grid place-items-center text-slate-700 font-semibold"
                    >
                      {{ p }}
                    </div>
                  </div>
                  <div
                    class="flex items-center gap-2 text-[10px] text-slate-600"
                  >
                    <span class="flex items-center gap-1">
                      <i class="bi bi-chat-dots-fill"></i>
                      {{ card.comments || 0 }}</span
                    >
                    <span class="flex items-center gap-1">
                      <i class="bi bi-paperclip"></i>
                      {{ card.attachments || 0 }}</span
                    >
                  </div>
                </div>

                <div class="text-[9px] text-slate-500">
                  {{ card.time }}
                </div>
              </article>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>

<!-- EDIT MODAL -->
<div *ngIf="isEditOpen" class="fixed inset-0 z-50 bg-black/30 flex items-center justify-center">
  <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-sm font-semibold text-slate-900">Edit task</h2>
      <button class="text-slate-400 hover:text-slate-600" (click)="closeEditModal()">✕</button>
    </div>

    <div class="space-y-3 text-xs">
      <!-- Title -->
      <div>
        <label class="block mb-1 text-slate-600">Title</label>
        <input
          type="text"
          class="w-full border border-slate-200 rounded-xl px-3 py-2 text-xs outline-none focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300"
          [(ngModel)]="editTitle" />
      </div>

      <!-- Description -->
      <div>
        <label class="block mb-1 text-slate-600">Description</label>
        <textarea
          rows="3"
          class="w-full border border-slate-200 rounded-xl px-3 py-2 text-xs outline-none focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300"
          [(ngModel)]="editDescription"></textarea>
      </div>

      <!-- Tags -->
      <div>
        <label class="block mb-1 text-slate-600">Tags (comma separated)</label>
        <input
          type="text"
          class="w-full border border-slate-200 rounded-xl px-3 py-2 text-xs outline-none focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300"
          placeholder="#website, #client"
          [(ngModel)]="editTags" />
      </div>

      <!-- Progress + Status -->
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="block mb-1 text-slate-600">Progress (%)</label>
          <input
            type="number"
            min="0"
            max="100"
            class="w-full border border-slate-200 rounded-xl px-3 py-2 text-xs outline-none focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300"
            [(ngModel)]="editProgressPercent" />
        </div>

        <div>
          <label class="block mb-1 text-slate-600">Status</label>
          <select
            class="w-full border border-slate-200 rounded-xl px-3 py-2 text-xs outline-none focus:ring-2 focus:ring-indigo-100 focus:border-indigo-300 bg-white"
            [(ngModel)]="editStatus">
            <option value="todo">Todo / New</option>
            <option value="in-progress">In Progress</option>
            <option value="review">In Review</option>
            <option value="done">Done</option>
          </select>
        </div>
      </div>
    </div>

    <div class="mt-5 flex justify-end gap-2 text-xs">
      <button
        class="px-3 py-1.5 rounded-xl border border-slate-200 text-slate-600 hover:bg-slate-50"
        (click)="closeEditModal()">
        Cancel
      </button>
      <button
        class="px-4 py-1.5 rounded-xl bg-slate-900 text-white hover:bg-slate-800"
        (click)="saveEditModal()">
        Save
      </button>
    </div>
  </div>
</div>
